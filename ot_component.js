[a.INDEX.id]:o+1,[a.SKU.id]:r.sku,[a.NAME.id]:r.item_name,[a.VOLUME.id]:r.volume,[a.UNITS.id]:r.default_units_per_case,[a.EXPECTED_QTY.id]:Math.floor(r.shipped_qty||0),[a.RECEIVED_QTY.id]:Math.floor(r.shipped_qty_received||0),[a.EXPECTED_COST.id]:St(ST(r)),[a.NEW_COST.id]:St(bT(r)),[a.CHANGE_PERCENT.id]:wT(r),[a.CHANGE_PERCENT_INDICATOR.id]:`<div class="${wT(r)<=0?"red-triangle":"green-triangle"}"></div>`};o++,i.push(t)}return{columns:IT(a),rows:i}}var OT={components:{CustomModal:qo,DetailContainer:f_,SectionTitle:tl,AllowPermission:wi,CustomTable:Wr,Card:Is,StatusLabel:Mm,Button:fe,InfoListItem:jn,CrudTable:Ia,SupplierInvoiceStat:PI,SupplierAmountInput:RI,SupplierInvoiceStepMarker:UI,Spinner:ys,MenuOptions:Ea,CustomInput:Ni,LinkComponent:ya},data(){return{showInputs:!0,receiving:!1,taxData:null,posting:!1,success:!1,editMode:!1,loading:!0,PERMISSION_CODES:A,supplierData:null,supplierInvoice:null,supplierInvoiceItems:[],cancellingOrder:!1,completingOrder:!1,STATUS_COLORS:Ma,menuOptions:{PRINT:{color:"grey",icon:"print",id:"PRINT",title:"Print"}},page:1,limit:10,totalPages:1,totalResults:0,tableData:{viewInvoiceColumns:[],viewInvoiceRows:[],receiveProductColumns:[],receiveProductRows:[],reviewAndPostColumns:[],reviewAndPostRows:[]}}},async mounted(){await this.fetchData(),this.checkWrapReviewScreen(),this.setData({pageTitle:"Supplier Invoice Details"}),this.loading=!1,this.removeReceivedQtyRoundings()},watch:{$route(t){this.checkWrapReviewScreen(),this.removeReceivedQtyRoundings()},limit(t){this.totalPages=Math.ceil(this.totalResults/t)},paginatedItems(t){this.updateTableData()}},methods:{...Object(n["b"])("misc",["setData"]),round2Fixed:St,generateReviewAndPostSupplierTableData:PT,updateTableData(){const t=PT(this.paginatedItems,this.showTotalCost),e=TT(this.paginatedItems,this.showTotalCost),s=AT(this.paginatedItems,this.isReceive,this.isPosted,this.showInputs);this.tableData={...this.tableData,viewInvoiceColumns:e.columns,viewInvoiceRows:e.rows,receiveProductColumns:s.columns,receiveProductRows:s.rows,reviewAndPostColumns:t.columns,reviewAndPostRows:t.rows}},handleShippedQtyUpdate({id:t,key:e,value:s}){this.supplierInvoiceItems=this.supplierInvoiceItems.map(i=>(i.id===t&&(i[e]=s),i));const i=this.supplierInvoiceItems.find(e=>e.id===t);this.removeDecimalsOnShippedQty(i)},removeReceivedQtyRoundings(){this.supplierInvoiceItems=this.supplierInvoiceItems.map(t=>(t.shipped_qty_received=Math.floor(t.shipped_qty_received),t)),this.showInputs=!1,setTimeout(()=>{this.showInputs=!0})},removeDecimalsOnShippedQty(t){let e=!1;this.supplierInvoiceItems=this.supplierInvoiceItems.map(s=>(t.sku==s.sku&&(t.shipped_qty_received%1!=0&&(e=!0),s.shipped_qty_received=Math.floor(t.shipped_qty_received)),s)),e&&(this.showInputs=!1,setTimeout(()=>{this.showInputs=!0}))},getChangePercent(t){const e=this.getPrice(t)?this.getPriceReceived(t)/this.getPrice(t)*100-100:0;return Math.round(100*e)/100},getPrice(t){return Number((t.shipped_qty||0)*(t.unit_price||0)||0)},getPriceReceived(t){return Number((t.shipped_qty_received||0)*(t.unit_price_received||0)||0)},usDateFormat:Vt,checkWrapReviewScreen(){this.isPosted&&this.step<=2&&this.navigateToReviewScreen()},navigateToReceiveScreen(){this.$router.push(`/supplier-invoices/${this.supplierInvoice.name}/receive`)},navigateToReviewScreen(){this.$router.push(`/supplier-invoices/${this.supplierInvoice.name}/review`)},handleMenuOptionSelection(t){if(t)switch(t.id){case this.menuOptions.PRINT.id:console.log("Archive");break;default:console.log("No action for this menu option");break}},async receiveProducts(){try{if(this.receiving)return;this.receiving=!0;const t={updateItems:this.supplierInvoiceItems.map(t=>({item_id:t.id,shipped_qty_received:t.shipped_qty_received}))},e="/supplier-invoices/"+this.supplierInvoice.id,s=await I.STOCK_IMPORT.patch(e,t);s.data.result&&(this.supplierInvoice=s.data.result.supplierInvoice,this.supplierInvoiceItems=s.data.result.supplierInvoiceItems||[]),this.$toast.success("Items received successfully!"),this.navigateToReviewScreen()}catch(t){console.log("error in fetching user init data",t)}this.receiving=!1},async postInvoice(){try{if(this.isPosted||this.posting)return;this.posting=!0;const t={},e=`/supplier-invoices/${this.supplierInvoice.id}/post`,s=await I.STOCK_IMPORT.patch(e,t);s.data.result&&(this.supplierInvoice=s.data.result.supplierInvoice,this.supplierInvoiceItems=s.data.result.supplierInvoiceItems||[]),this.success=!0,this.$toast.success("Supplier Invoice posted successfully!")}catch(t){console.log("error in posting supplier invoice",t),this.$toast.error(Pt(t,"Error in posting supplier invoice"))}this.posting=!1},async fetchData(){try{this.loading=!0;const t=await I.STOCK_IMPORT.get("/supplier-invoices/"+(this.$route.params&&this.$route.params.id));t.data.result&&(this.taxData=t.data.result.taxData,this.supplierInvoice=t.data.result.supplierInvoice,this.supplierInvoiceItems=t.data.result.supplierInvoiceItems||[],this.totalResults=this.supplierInvoiceItems.length,this.totalPages=Math.ceil(this.totalResults/this.limit),this.supplierData=this.supplierInvoice.supplierData)}catch(t){console.log("error in fetching user init data",t)}this.loading=!1},async cancelOrder(){try{await xt("Cancelled","Supplier Invoice cancelled!",async()=>{this.cancellingOrder=!0,await this.updateOrderStatus(0,1),this.cancellingOrder=!1},"Are you sure to cancel this Supplier Invoice?")}catch(t){}},async markComplete(){try{await xt("Completed","Supplier Invoice marked complete!",async()=>{this.completingOrder=!0,await this.updateOrderStatus(1,0),this.completingOrder=!1},"Are you sure to complete this Supplier Invoice?")}catch(t){}},async updateOrderStatus(t,e){try{const s={completed:t,cancelled:e},i=`/supplier-invoices/${this.supplierInvoice.id}/status`;await I.INVOICE.patch(i,s);this.fetchData()}catch(s){console.log("error in updating supplier invoice status",s)}}},computed:{...Object(n["d"])("misc",["showSidebar","countries"]),paginatedItems(){return this.supplierInvoiceItems},showTotalCost(){return!this.isAglc},allInCostColumnName(){return"All in Cost"},isAglc(){const t=this.supplierInvoice.supplier_name&&this.supplierInvoice.supplier_name.toUpperCase().includes(Ua.AGLC),e=this.supplierData&&this.supplierData.idx==Ua.CONNECT_LOGISTICS_SERVICES_INC;return t||e},orderDisabled(){return this.cancellingOrder||this.completingOrder||this.supplierInvoice&&this.supplierInvoice.completed||this.supplierInvoice&&this.supplierInvoice.cancelled},isReceive(){return 2==this.step},isReview(){return 3==this.step},isPosted(){return this.supplierInvoice&&this.supplierInvoice.completed},step(){return this.$route.params.type?"receive"==this.$route.params.type?2:3:1}}},xT=OT,ET=(i("e897"),i("b48f"),Object(L["a"])(xT,mT,hT,!1,null,"0fd598ad",null)),DT=ET.exports,RT=function(){var t=this,e=t._self._c;return e("AllowPermission",{attrs:{permission:t.PERMISSION_CODES.CMS_VIEW_SUPPLIER_INVOICE}},[e("div",{staticClass:"d-flex mb-3 justify-content-end"},[e("SingleSelectChip",{attrs:{options:t.warehouseOptions},model:{value:t.warehouse_id,callback:function(e){t.warehouse_id=e},expression:"warehouse_id"}})],1),e("div",[e("CreateCustomerOrderForm",{attrs:{show:t.showCreateCustomerOrderForm},on:{close:function(e){t.showCreateCustomerOrderForm=!1}}}),e("Card",[e("div",{},[e("div",{staticClass:"d-flex items-center justify-content-end",staticStyle:{gap:"20px"}},[e("Button",{attrs:{noMargin:""},on:{click:function(e){t.showCreateCustomerOrderForm=!0}}},[e("i",{staticClass:"fas fa-plus",staticStyle:{"margin-right":"4px"}}),t._v(" New Order ")])],1),e("div",{staticClass:"d-flex items-center pe-5 my-3",staticStyle:{gap:"20px"}},[e("CustomInput",{staticStyle:{width:"400px"},attrs:{searchInput:"",placeholder:"Search by ID or Customer Name and Warehouse",type:"text",inputStyle:{width:"350px"}},on:{enter:t.searchOrders},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),e("FilterBtnAndModal",{on:{reset:t.reset,apply:t.searchOrders}},[e("div",[e("div",{staticClass:"custom-filter-modal-item"},[e("SingleSelectChip",{attrs:{options:t.salesOrderStatusOptions,title:"Status*"},model:{value:t.orderStatus,callback:function(e){t.orderStatus=e},expression:"orderStatus"}})],1),e("div",{staticClass:"custom-filter-modal-item"},[e("CustomInput",{attrs:{type:"date",label:"Created Date From"},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}})],1),e("div",{staticClass:"custom-filter-modal-item"},[e("CustomInput",{attrs:{type:"date",label:"Created Date To"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1),e("div",{staticClass:"custom-filter-modal-item"})])]),e("Button",{staticClass:"mb-4",attrs:{condensed:!0},on:{click:t.fetchOrders}},[t._v("Search")])],1),t.loadingData?e("Spinner"):t._e(),t.paginatedOrders.length?e("CrudTable",{staticClass:"min-h-screen",staticStyle:{"font-size":"12px","max-width":"unset","min-width":"100%",width:"unset"},attrs:{customPage:t.page,customLimit:Number(t.limit),customTotalPages:t.totalPages,customTotalResults:t.totalResults,customTable:"",scrollable:!0,bordered:""},on:{customPage:function(e){t.page=e},customLimit:t.handleLimitChange},scopedSlots:t._u([{key:"thead",fn:function(){return[e("tr",[e("th",{on:{click:function(e){return t.setSortColumn("name")}}},[t._v(" ID "),"name"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",{on:{click:function(e){return t.setSortColumn("customer_name")}}},[t._v(" Customer Name "),"customer_name"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",{on:{click:function(e){return t.setSortColumn("createdAtFormatted2")}}},[t._v(" Created On "),"createdAtFormatted2"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",{on:{click:function(e){return t.setSortColumn("updatedAtFormatted2")}}},[t._v(" Order Fill Date "),"updatedAtFormatted2"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",{on:{click:function(e){return t.setSortColumn("totalItemsQty")}}},[t._v(" Products Qty "),"totalItemsQty"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",{on:{click:function(e){return t.setSortColumn("delivery_date")}}},[t._v(" Invoice Date "),"delivery_date"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",{on:{click:function(e){return t.setSortColumn("completed")}}},[t._v(" Status "),"completed"===t.sortColumn?e("span",{staticClass:"sort-indicator"},[t._v(" "+t._s("asc"===t.sortDirection?"↑":"↓")+" ")]):t._e()]),e("th",[t._v("Actions")])])]},proxy:!0},{key:"tbody",fn:function(){return t._l(t.paginatedOrders,(function(s,i){return e("tr",{key:s.id},[e("td",{staticStyle:{"min-width":"30px"}},[e("LinkComponent",{staticStyle:{color:"#427ff9","font-weight":"bold"},attrs:{to:"/customer-orders/"+s.name}},[t._v(" "+t._s(s.name)+" ")])],1),e("td",{staticStyle:{"min-width":"30px"}},[t._v(" "+t._s(s.customer_name)+" ")]),e("td",{staticStyle:{"min-width":"30px"}},[t._v(" "+t._s(s.createdAt)+" ")]),e("td",{staticStyle:{"min-width":"30px"}},[t._v(" "+t._s(s.delivery_date?t.formatDate(s.delivery_date):"NA")+" ")]),e("td",{staticStyle:{"min-width":"30px","text-align":"center"}},[t._v(" "+t._s(s.units_ordered||0)+" ")]),e("td",{staticStyle:{"min-width":"30px"}},[t._v(" "+t._s(s.delivery_date?t.formatDate(s.delivery_date):"NA")+" ")]),e("td",{staticStyle:{"min-width":"30px"}},[t.editMode?t._e():e("StatusLabel",{attrs:{bold:"",color:t.STATUS_COLORS.CUSTOMER_INVOICE[null===s||void 0===s?void 0:s.mark_order_status]||"#25293d",label:null===s||void 0===s?void 0:s.mark_order_status.replace("_"," ").toLowerCase().replace(/\b\w/g,t=>t.toUpperCase())}})],1),e("td",[e("div",{staticClass:"d-flex justify-content-end",staticStyle:{gap:"5px"}},[e("EditBtn",{attrs:{to:"/customer-orders/"+s.name}}),e("DeleteBtn",{on:{click:function(e){return t.deleteOrder(s)}}})],1)])])}))},proxy:!0}],null,!1,1002140935)}):t.loadingData?t._e():e("div",[t._v("No Supplier Invoices Found")])],1)])],1)])},kT=[],MT=function(){var t=this,e=t._self._c;return e("div",[e("CustomModal",{attrs:{minHeight:"300px",title:"",show:t.show},on:{close:function(e){return t.$emit("close")}}},[e("div",{staticClass:"my-4"},[e("div",{staticClass:"row gx-5"},[e("div",{staticClass:"col-md-6 d-flex flex-column justify-content-end"},[e("label",{staticClass:"mb-2",staticStyle:{color:"#888"},attrs:{for:"c-btn"}},[t._v(t._s(t.selectedCustomer?"Customer Selected":"Open Search Modal"))]),e("button",{staticClass:"w-full border py-2",staticStyle:{"border-radius":"14px"},on:{click:function(e){t.showCustomerModal=!0}}},[t._v(" "+t._s(t.selectedCustomer?t.selectedCustomer.customer_name:"Select Customer")+" ")])]),e("div",{staticClass:"col-md-6"},[e("SingleSelectChip",{attrs:{options:t.warehouseOptions,title:"Select Warehouses*"},model:{value:t.warehouse_id,callback:function(e){t.warehouse_id=e},expression:"warehouse_id"}})],1),e("div",{staticClass:"col-md-6"},[e("CustomInput",{attrs:{placeholder:"Notes",type:"notes",label:"Notes"},model:{value:t.notes,callback:function(e){t.notes=e},expression:"notes"}})],1),e("div",{staticClass:"col-md-6"},[e("CustomInput",{attrs:{placeholder:"Expected Date",type:"date",label:"Order fill by*"},model:{value:t.due_date,callback:function(e){t.due_date=e},expression:"due_date"}})],1)]),e("div",{staticClass:"d-flex justify-content-end",staticStyle:{gap:"25px"}},[e("Button",{attrs:{type:"button",lightVersion:""},on:{click:function(e){return t.$emit("close")}}},[t._v("Cancel")]),e("Button",{attrs:{type:"button"},on:{click:t.createPO}},[t._v(t._s(t.processingForm?"Please wait...":"Next"))])],1)])]),e("CustomerSearchModal",{attrs:{allowSearchByTypes:"",show:t.showCustomerModal,"allow-complete-selection":"","single-select":""},on:{show:function(e){t.showCustomerModal=!1},selectedCustomers:t.handleCustomerSelect}})],1)},NT=[],LT={components:{Card:Is,Button:fe,CustomModal:qo,AllowPermission:wi,CustomInput:Ni,SingleSelectChip:na,SelectDropdown:ri,CustomerSearchModal:Nu},computed:{...Object(n["d"])("misc",["warehouses","suppliers"]),liquorImportMode(t){return this.productType==Da.LIQUOR},supplierOptions(){return this.suppliers.map(t=>({id:t.id,title:t.name}))},storeOptions(){return[{id:"",title:"Select an Option"},...this.warehouses.map(t=>({id:t.id,title:t.name}))]},warehouseOptions(){return this.warehouses.map(t=>({id:t.id,title:t.name}))}},data(){return{PERMISSION_CODES:A,customerId:"",warehouse_id:"",due_date:null,freightAndOtherFees:null,referenceId:null,notes:null,processingForm:null,customers:[{id:"",title:"Select an Option"}],listedCustomers:[],showCustomerModal:!1,selectedCustomer:null}},async mounted(){},methods:{...Object(iI["mapActions"])("misc",["setData"]),async handleCustomerSelect(t){this.selectedCustomer=t,this.showCustomerModal=!1},async createPO(){try{var t,e,s,i,a,o,r,n,l,c,d;const u=this.warehouses.find(t=>t.id==this.warehouse_id),p={customer:(null===(t=this.selectedCustomer)||void 0===t?void 0:t.id)||"",customer_name:(null===this||void 0===this||null===(e=this.selectedCustomer)||void 0===e?void 0:e.customer_name)||"",contact_phone:(null===this||void 0===this||null===(s=this.selectedCustomer)||void 0===s?void 0:s.customer_primary_contact)||(null===this||void 0===this||null===(i=this.selectedCustomer)||void 0===i?void 0:i.mobile_no)||"",customer_mobile_no:(null===this||void 0===this||null===(a=this.selectedCustomer)||void 0===a?void 0:a.customer_primary_contact)||(null===this||void 0===this||null===(o=this.selectedCustomer)||void 0===o?void 0:o.mobile_no)||"",contact_email:(null===this||void 0===this||null===(r=this.selectedCustomer)||void 0===r?void 0:r.email_id)||"",customer_email_id:(null===this||void 0===this||null===(n=this.selectedCustomer)||void 0===n?void 0:n.email_id)||"",customer_address:(null===this||void 0===this||null===(l=this.selectedCustomer)||void 0===l?void 0:l.customer_primary_address)||"",customer_group:(null===this||void 0===this||null===(c=this.selectedCustomer)||void 0===c?void 0:c.customer_group)||"",customer_group_id:(null===this||void 0===this||null===(d=this.selectedCustomer)||void 0===d?void 0:d.customer_group_id)||"",warehouse_id:this.warehouse_id,delivery_date:this.due_date,notes:this.notes,set_warehouse:u.name,mark_order_status:"OPEN"};if(!p.customer||!p.warehouse_id||!p.delivery_date)return this.$toast.error("Please fillup mandatory fields!");this.processingForm=!0;const m=await I.INVOICE.post("/sales-orders",p);this.$router.push("/customer-orders/"+m.data.result.name),this.$toast.success("Purchase order created successfully")}catch(u){console.log("error in creating sales order",u),this.$toast.error(Pt(u))}this.processingForm=!1},handleImportModalClose(){this.importSuccess?window.location.reload():this.showImportResult=!1}},props:{show:{type:Boolean,default:!1}}},BT=LT,UT=(i("9ff4"),Object(L["a"])(BT,MT,NT,!1,null,"7b7e1ec9",null)),FT=UT.exports,VT={data(){return{search:"",page:1,startDate:"",endDate:"",totalResults:0,limit:10,showCreateCustomerOrderForm:!1,totalPages:0,loadingData:!1,orderStatus:"",warehouse_id:"",salesOrderStatusOptions:[{id:"OPEN",title:"Open",color:"black"},{id:"COMPLETED",title:"Order Completed",color:"black"},{id:"INVOICED",title:"Invoiced",color:"black"},{id:"PAID",title:"Paid",color:"purple",disabled:!0},{id:"CANCELLED",title:"Cancelled",color:"black"}],loading:!0,salesOrders:[],createFields:[Et("Name*","name","text",!0)],PERMISSION_CODES:A,STATUS_COLORS:Ma,fetchOrdersTimeout:null,filterVal:"",filterOptions:[],menuOptions:{COMMING_SOON:{id:"COMMING_SOON",title:"Coming Soon...",icon:"clock"}},sortColumn:"",sortDirection:"asc",warehouse_id:"",editMode:!1}},computed:{...Object(n["d"])("misc",["theme","THEMES","suppliers","warehouses"]),paginatedOrders(){return this.salesOrders},warehouseOptions(){return[{id:"",title:"ALL"},...this.warehouses.map(t=>({id:t.id,title:t.name}))]},supplierOptions(){return this.suppliers.map(t=>({id:t.id,title:t.name}))},sortedCustomerInvoices(){let t=[...this.salesOrders];return this.sortColumn&&(t=t.sort((t,e)=>{var s,i;const a=((null===(s=t[this.sortColumn])||void 0===s?void 0:s.toString())||"").toLowerCase(),o=((null===(i=e[this.sortColumn])||void 0===i?void 0:i.toString())||"").toLowerCase();return a<o?"asc"===this.sortDirection?-1:1:a>o?"asc"===this.sortDirection?1:-1:0})),t}},components:{CreateCustomerOrderForm:FT,FilterBtnAndModal:cr,LinkComponent:ya,CrudTable:Ia,CustomInput:Ni,CustomTable:Wr,Paginator:Wi,AllowPermission:wi,CrudIndex:Ja,Button:fe,Card:Is,Spinner:ys,StatusLabel:Mm,MenuOptions:Ea,SelectDropdown:ri,SingleSelectChip:na,DeleteBtn:ic,EditBtn:Ln},async mounted(){this.loading=!1,this.$route.query.status&&(this.orderStatus=this.$route.query.status),this.setData({pageTitle:"Orders Management"}),this.fetchOrders()},methods:{...Object(n["b"])("misc",["setData"]),searchOrders(){1===parseInt(this.page)?this.fetchOrders():this.page=1},formatDate(t){if(!t)return"";const e=new Date(t),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),a=e.getFullYear();return`${s}/${i}/${a}`},handleLimitChange(t){this.limit=Number(t),this.page=1},reset(){this.search="",this.limit=10,this.startDate="",this.endDate="",this.orderStatus="",this.warehouse_id="",1===parseInt(this.page)?this.fetchOrders():this.page=1},async deleteOrder(t){if("INVOICED"!==t.mark_order_status)if("PAID"!==t.mark_order_status){if(window.confirm("Are you sure you want to delete this order?"))try{if(await I.INVOICE.delete("/sales-orders/"+t.name),this.$toast.success("Sales Order deleted successfully."),this.salesOrders=this.salesOrders.filter(e=>e.name!==t.name),this.sortedCustomerInvoices=this.sortedCustomerInvoices.filter(e=>e.name!==t.name),1!==pa